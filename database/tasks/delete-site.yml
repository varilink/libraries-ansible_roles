# ------------------------------------------------------------------------------
# database/tasks/delete-site.yml
# ------------------------------------------------------------------------------

# Delete the database for a WordPress site and the associated user account to
# access it.

---

- block:

    - name: Delete database user for the WordPress site
      community.mysql.mysql_user:
        name: "{{ wp_server_name | regex_replace ('\\.', '_') }}"
        host: |-
          {% if wp_database_host is defined %}
          {{- inventory_hostname }}.{{ home_domain }}
          {%- else -%}
          localhost
          {%- endif %}
        login_unix_socket: /var/run/mysqld/mysqld.sock
        state: absent

    - name: Delete database for the WordPress site
      community.mysql.mysql_db:
        name: "{{ wp_server_name | regex_replace ('\\.', '_') }}"
        login_unix_socket: /var/run/mysqld/mysqld.sock
        state: absent

  become: yes
